{"schema_version":3,"name":"Loops With Counters","description":"Many job operations have consistent methods to break out of of the loop once a condition is met, however, there can be many instances where breaking out a loop prior to that condition makes more sense. In Tines, we can introduce a 'Counter' which the workflow can increment and use in order to break out of the loop on the chance that the condition being met isn't available in a timely manner.","guid":"e16158c687df4d558d3580dcc9c257a9","exported_at":"2021-05-19T20:19:25Z","agents":[{"type":"Agents::TriggerAgent","name":"Trigger if Complete","disabled":false,"guid":"599b264f1ab5d8f5685400de6bd730f2","options":{"rules":[{"type":"regex","value":"success","path":"{{.check_scan_status.body.state}}"}]},"keep_events_for":0},{"type":"Agents::TriggerAgent","name":"Counter More Than 20","disabled":false,"guid":"dbefda2fbd9d72b81578e5be8b64d496","options":{"rules":[{"type":"field>=value","value":"20","path":"{{.increment_counter.counter}}"}]},"keep_events_for":0},{"type":"Agents::TriggerAgent","name":"Counter Less Than 20","disabled":false,"guid":"36ea073720149d2dea841ac412ad0935","options":{"rules":[{"type":"field<value","value":"20","path":"{{.increment_counter.counter}}"}]},"keep_events_for":0},{"type":"Agents::TriggerAgent","name":"Trigger if IN Queue","disabled":false,"guid":"9d45a60e3c2e0d1c3734c1bd7bed354a","options":{"rules":[{"type":"regex","value":"in_queue|in_progress","path":"{{.check_scan_status.body.state}}"}]},"keep_events_for":0},{"type":"Agents::EventTransformationAgent","name":"Build Results","disabled":false,"guid":"20364e9b8c718619e3b087bd95fdacd0","options":{"mode":"message_only","payload":{"new":"{% if trigger_if_file_exists.rule_matched %}false{% elsif trigger_if_error.rule_matched%}error{% else %}true{% endif %}","analysis_date":"{% if trigger_if_error.rule_matched%}error{% elsif counter_more_than_20.rule_matched%}timed out{% else %}{{.retrieve_scan_result.body.analysis_start_time}}{% endif %}","malicious":"{% if retrieve_scan_result.body.verdict == 'malicious' or retrieve_scan_result.body.verdict == 'suspicious' %}true{% elsif trigger_if_error.rule_matched%}error{% elsif counter_more_than_20.rule_matched%}timed out{% else %}false{% endif %}","engine":"hybrid analysis","file_name":"{{.webhook_agent.file_name}}","analysis_link":"https://www.hybrid-analysis.com/sample/{{.retrieve_scan_result.body.sha256}}"}},"schedule":null,"keep_events_for":0},{"type":"Agents::EventTransformationAgent","name":"Increment Counter","disabled":false,"guid":"19f4126d0eab1f2b3d7f2645428a61ef","options":{"mode":"message_only","payload":{"counter":"{{.increment_counter.counter | plus: 1}}"}},"schedule":null,"keep_events_for":0},{"type":"Agents::TriggerAgent","name":"Trigger if Error","disabled":false,"guid":"06d44822b23438df835a4d87cc86c52f","options":{"rules":[{"type":"regex","value":"Error","path":"{{.check_scan_status.body.state}}"}]},"keep_events_for":0},{"type":"Agents::HTTPRequestAgent","name":"Check Scan Status","disabled":false,"guid":"196cd225bc7340f66d6889e762d881ac","options":{"url":"https://www.hybrid-analysis.com/api/v2/report/{{.upload_file_to_hybrid_analysis.body.job_id}}/state","method":"get","headers":{"api-key":"{% credential HybridAnalysisAPI %}"},"log_error_on_status":[],"retry_on_status":["429"]},"schedule":null,"keep_events_for":0},{"type":"Agents::EventTransformationAgent","name":"Delay Event","disabled":false,"guid":"0596c6ec4738268cb0d19cb80a926079","options":{"mode":"delay","seconds":"60"},"schedule":null,"keep_events_for":0},{"type":"Agents::HTTPRequestAgent","name":"Upload File to Hybrid Analysis","disabled":false,"guid":"19c59d99f77215d97ddf5eaab7ffffa4","options":{"url":"https://www.hybrid-analysis.com/api/v2/submit/file","content_type":"data","method":"post","payload":{"file":{"contents":"{{.webhook_agent.base64_encoded_contents | base64_decode}}","filename":"{{.webhook_agent.file_name}}"},"environment_id":"100","allow_community_access":"false"},"headers":{"api-key":"{% credential HybridAnalysisAPI %}"},"log_error_on_status":[],"retry_on_status":["429"]},"schedule":null,"keep_events_for":0}],"diagram_notes":[{"content":"Increment Counter\n\nThe 'Increment Counter' action will set a base integer value that will be increased by one each time it is trigger within the loop looking for a scan status of 'complete' from Hybrid Analysis.","position":[240.0,390.0],"guid":"9308307755a79959960f19e3547b5042"}],"links":[{"source":0,"receiver":4},{"source":1,"receiver":4},{"source":2,"receiver":8},{"source":3,"receiver":5},{"source":5,"receiver":1},{"source":5,"receiver":2},{"source":6,"receiver":4},{"source":7,"receiver":0},{"source":7,"receiver":3},{"source":7,"receiver":6},{"source":8,"receiver":7},{"source":9,"receiver":7}],"diagram_layout":"{\"599b264f1ab5d8f5685400de6bd730f2\":[960.0,345.0],\"dbefda2fbd9d72b81578e5be8b64d496\":[945.0,495.0],\"36ea073720149d2dea841ac412ad0935\":[561.0,501.0],\"9d45a60e3c2e0d1c3734c1bd7bed354a\":[561.0,351.0],\"20364e9b8c718619e3b087bd95fdacd0\":[780.0,570.0],\"19f4126d0eab1f2b3d7f2645428a61ef\":[561.0,426.0],\"06d44822b23438df835a4d87cc86c52f\":[780.0,345.0],\"196cd225bc7340f66d6889e762d881ac\":[561.0,276.0],\"0596c6ec4738268cb0d19cb80a926079\":[561.0,576.0],\"19c59d99f77215d97ddf5eaab7ffffa4\":[561.0,186.0]}","send_to_story_enabled":false,"entry_agent_guid":null,"exit_agent_guids":[],"exit_agent_guid":null,"send_to_stories":[],"form":{"name":"Loops With Counters Form","description":"","fields":[],"visibility":"tenant","agent_guid":null,"success_message":"Thank you for your submission"}}